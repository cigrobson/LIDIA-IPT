<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIDIA - Painel Administrativo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .admin-header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-title {
            color: #4f46e5;
            font-size: 2.5rem;
            font-weight: 700;
        }

        .admin-subtitle {
            color: #6b7280;
            font-size: 1.1rem;
            margin-top: 5px;
        }

        .admin-actions {
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #4f46e5;
            color: white;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f3f4f6;
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #374151;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #4f46e5;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #6b7280;
            font-size: 0.9rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            transition: width 0.3s ease;
        }

        .table-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th {
            background: #f8fafc;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #e5e7eb;
        }

        .table td {
            padding: 15px;
            border-bottom: 1px solid #e5e7eb;
        }

        .table tr:hover {
            background: #f8fafc;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-active {
            background: #dcfce7;
            color: #166534;
        }

        .status-inactive {
            background: #fee2e2;
            color: #991b1b;
        }

        .status-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .tab-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .tab-header {
            display: flex;
            border-bottom: 2px solid #e5e7eb;
            overflow-x: auto;
        }

        .tab-button {
            padding: 15px 25px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #6b7280;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .tab-button.active {
            color: #4f46e5;
            border-bottom: 3px solid #4f46e5;
        }

        .tab-content {
            padding: 25px;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #4f46e5;
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .alert-success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e5e7eb;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .metric-card {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .metric-title {
            font-weight: 600;
            color: #374151;
            margin-bottom: 10px;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #4f46e5;
        }

        .control-panel {
            background: #fef3c7;
            border: 1px solid #fde68a;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .control-title {
            font-weight: 700;
            color: #92400e;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 34px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #4f46e5;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .log-viewer {
            background: #1f2937;
            color: #f9fafb;
            border-radius: 8px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-radius: 4px;
        }

        .log-info { background: rgba(59, 130, 246, 0.1); }
        .log-warning { background: rgba(245, 158, 11, 0.1); }
        .log-error { background: rgba(239, 68, 68, 0.1); }

        @media (max-width: 768px) {
            .admin-header {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .tab-header {
                overflow-x: auto;
            }

            .admin-actions {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Header -->
        <div class="admin-header">
            <div>
                <h1 class="admin-title">üöÄ LIDIA Admin</h1>
                <p class="admin-subtitle">Painel de Administra√ß√£o Completo do Sistema</p>
            </div>
            <div class="admin-actions">
                <a href="/" class="btn btn-secondary">üí¨ Voltar ao Chat</a>
                <button onclick="refreshData()" class="btn btn-primary">üîÑ Atualizar</button>
                <button onclick="logout()" class="btn btn-danger">üö™ Sair</button>
            </div>
        </div>

        <!-- Dashboard Cards -->
        <div class="dashboard-grid">
            <div class="dashboard-card">
                <div class="card-header">
                    <h3 class="card-title">üìä Estat√≠sticas Gerais</h3>
                    <span class="status-badge status-active" id="systemStatus">Sistema Online</span>
                </div>
                <div id="general-stats">
                    <div class="loading">
                        <div class="spinner"></div>
                        Carregando estat√≠sticas...
                    </div>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <h3 class="card-title">üí∞ Custos & Or√ßamento</h3>
                    <button onclick="exportCostReport()" class="btn btn-primary" style="padding: 6px 12px; font-size: 0.8rem;">üìÑ Relat√≥rio</button>
                </div>
                <div id="cost-stats">
                    <div class="loading">
                        <div class="spinner"></div>
                        Carregando custos...
                    </div>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <h3 class="card-title">üìà Atividade dos Usu√°rios</h3>
                </div>
                <div class="chart-container">
                    <canvas id="activityChart"></canvas>
                </div>
            </div>

            <div class="dashboard-card">
                <div class="card-header">
                    <h3 class="card-title">üèÜ Top Usu√°rios</h3>
                </div>
                <div id="top-users">
                    <div class="loading">
                        <div class="spinner"></div>
                        Carregando usu√°rios...
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs Container -->
        <div class="tab-container">
            <div class="tab-header">
                <button class="tab-button active" onclick="showTab('dashboard')">üìä Dashboard</button>
                <button class="tab-button" onclick="showTab('admins')">üîë Administradores</button>
                <button class="tab-button" onclick="showTab('users')">üë• Usu√°rios</button>
                <button class="tab-button" onclick="showTab('documents')">üìÑ Documentos</button>
                <button class="tab-button" onclick="showTab('rag')">üß† Sistema RAG</button>
                <button class="tab-button" onclick="showTab('system')">‚öôÔ∏è Sistema</button>
                <button class="tab-button" onclick="showTab('logs')">üìã Logs</button>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboard-tab" class="tab-content active">
                <h3 class="card-title">üìà Dashboard Detalhado</h3>
                
                <div class="dashboard-grid">
                    <div class="metric-card">
                        <div class="metric-title">üìä M√©tricas de Uso</div>
                        <div id="usage-metrics">Carregando...</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-title">‚ö° Performance</div>
                        <div id="performance-metrics">Carregando...</div>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="detailedChart"></canvas>
                </div>
            </div>

            <!-- Admins Tab -->
            <div id="admins-tab" class="tab-content">
                <h3 class="card-title">üîë Gerenciamento de Administradores</h3>
                
                <div id="admin-alerts"></div>
                
                <div style="margin-bottom: 30px;">
                    <h4 style="margin-bottom: 15px;">‚ûï Adicionar Novo Administrador</h4>
                    <div style="display: flex; gap: 15px; align-items: end;">
                        <div class="form-group" style="flex: 1; margin-bottom: 0;">
                            <label class="form-label">Email do novo administrador</label>
                            <input type="email" id="new-admin-email" class="form-input" placeholder="exemplo@ipt.br">
                        </div>
                        <button onclick="addAdmin()" class="btn btn-primary">‚úÖ Adicionar Admin</button>
                    </div>
                </div>

                <div id="admins-table">
                    <div class="loading">
                        <div class="spinner"></div>
                        Carregando administradores...
                    </div>
                </div>
            </div>

            <!-- Users Tab -->
            <div id="users-tab" class="tab-content">
                <h3 class="card-title">üë• Gerenciamento de Usu√°rios</h3>
                
                <div class="control-panel">
                    <div class="control-title">üõ°Ô∏è Controles de Acesso</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div>
                            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                <div class="toggle-switch">
                                    <input type="checkbox" id="allowNewUsers" checked>
                                    <span class="slider"></span>
                                </div>
                                Permitir novos usu√°rios
                            </label>
                        </div>
                        <div>
                            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                <div class="toggle-switch">
                                    <input type="checkbox" id="requireApproval">
                                    <span class="slider"></span>
                                </div>
                                Requer aprova√ß√£o
                            </label>
                        </div>
                    </div>
                </div>

                <div id="users-table">
                    <div class="loading">
                        <div class="spinner"></div>
                        Carregando usu√°rios...
                    </div>
                </div>
            </div>

            <!-- Documents Tab -->
            <div id="documents-tab" class="tab-content">
                <h3 class="card-title">üìÑ Gerenciamento de Documentos</h3>
                
                <div class="dashboard-grid">
                    <div class="metric-card">
                        <div class="metric-title">üìä Estat√≠sticas de Documentos</div>
                        <div id="document-stats">Carregando...</div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-title">üìà Uploads por Tipo</div>
                        <div class="chart-container">
                            <canvas id="documentTypeChart"></canvas>
                        </div>
                    </div>
                </div>

                <div id="documents-table">
                    <div class="loading">
                        <div class="spinner"></div>
                        Carregando documentos...
                    </div>
                </div>
            </div>

            <!-- RAG Tab -->
            <div id="rag-tab" class="tab-content">
                <h3 class="card-title">üß† Sistema RAG (Retrieval-Augmented Generation)</h3>
                
                <div class="alert alert-info">
                    <strong>‚ÑπÔ∏è Sobre o Sistema RAG:</strong> O RAG permite que a LIDIA use documentos enviados pelos usu√°rios como contexto para suas respostas, melhorando a precis√£o e relev√¢ncia das informa√ß√µes fornecidas.
                </div>

                <div class="control-panel">
                    <div class="control-title">‚öôÔ∏è Configura√ß√µes do RAG</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div>
                            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                                <div class="toggle-switch">
                                    <input type="checkbox" id="ragEnabled" checked>
                                    <span class="slider"></span>
                                </div>
                                Sistema RAG Habilitado
                            </label>
                        </div>
                        <div>
                            <label class="form-label">üìè Tamanho m√°ximo de contexto (caracteres)</label>
                            <input type="number" id="maxContextLength" class="form-input" value="3000" min="1000" max="10000">
                        </div>
                        <div>
                            <label class="form-label">üìÑ Tipos de arquivo permitidos</label>
                            <select id="allowedFileTypes" class="form-select" multiple>
                                <option value="pdf" selected>PDF</option>
                                <option value="docx" selected>Word (DOCX)</option>
                                <option value="txt" selected>Texto (TXT)</option>
                                <option value="csv" selected>CSV</option>
                                <option value="xlsx" selected>Excel (XLSX)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="metric-card">
                        <div class="metric-title">üìä Estat√≠sticas RAG</div>
                        <div id="rag-stats">
                            <div class="metric-value" id="documentsProcessed">0</div>
                            <div>Documentos processados hoje</div>
                            <br>
                            <div class="metric-value" id="ragQueries">0</div>
                            <div>Consultas com contexto documental</div>
                        </div>
                    </div>
                    
                    <div class="metric-card">
                        <div class="metric-title">üîß Ferramentas RAG</div>
                        <button onclick="rebuildIndex()" class="btn btn-warning" style="margin-bottom: 10px; width: 100%;">
                            üîÑ Reconstruir √çndice
                        </button>
                        <button onclick="clearDocuments()" class="btn btn-danger" style="width: 100%;">
                            üóëÔ∏è Limpar Documentos
                        </button>
                    </div>
                </div>
            </div>

            <!-- System Tab -->
            <div id="system-tab" class="tab-content">
                <h3 class="card-title">‚öôÔ∏è Configura√ß√µes do Sistema</h3>
                
                <div class="control-panel">
                    <div class="control-title">üõ†Ô∏è Configura√ß√µes Gerais</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div class="form-group">
                            <label class="form-label">üí∞ Or√ßamento Mensal (R$)</label>
                            <input type="number" id="monthlyBudget" class="form-input" value="200" min="100" max="1000">
                        </div>
                        <div class="form-group">
                            <label class="form-label">‚ö° Modelo de IA</label>
                            <select id="aiModel" class="form-select">
                                <option value="claude-3-haiku-20240307" selected>Claude 3 Haiku (R√°pido)</option>
                                <option value="claude-3-sonnet-20240229">Claude 3 Sonnet (Balanceado)</option>
                                <option value="claude-3-opus-20240229">Claude 3 Opus (Avan√ßado)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">üìù M√°ximo de tokens por resposta</label>
                            <input type="number" id="maxTokens" class="form-input" value="1500" min="500" max="4000">
                        </div>
                    </div>
                </div>

                <div class="control-panel">
                    <div class="control-title">üö® Alertas e Notifica√ß√µes</div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                        <div>
                            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                                <div class="toggle-switch">
                                    <input type="checkbox" id="budgetAlerts" checked>
                                    <span class="slider"></span>
                                </div>
                                Alertas de or√ßamento
                            </label>
                        </div>
                        <div>
                            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                                <div class="toggle-switch">
                                    <input type="checkbox" id="errorAlerts" checked>
                                    <span class="slider"></span>
                                </div>
                                Alertas de erro
                            </label>
                        </div>
                        <div>
                            <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                                <div class="toggle-switch">
                                    <input type="checkbox" id="usageAlerts">
                                    <span class="slider"></span>
                                </div>
                                Alertas de uso intenso
                            </label>
                        </div>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-title">üíæ Backup e Manuten√ß√£o</div>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        <button onclick="backupDatabase()" class="btn btn-success">üíæ Backup do Banco</button>
                        <button onclick="optimizeDatabase()" class="btn btn-primary">‚ö° Otimizar Banco</button>
                        <button onclick="clearOldLogs()" class="btn btn-warning">üßπ Limpar Logs Antigos</button>
                        <button onclick="exportData()" class="btn btn-secondary">üì§ Exportar Dados</button>
                    </div>
                </div>
            </div>

            <!-- Logs Tab -->
            <div id="logs-tab" class="tab-content">
                <h3 class="card-title">üìã Logs do Sistema</h3>
                
                <div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;">
                    <button onclick="loadLogs('all')" class="btn btn-primary">üîç Todos os Logs</button>
                    <button onclick="loadLogs('error')" class="btn btn-danger">‚ùå Erros</button>
                    <button onclick="loadLogs('access')" class="btn btn-secondary">üö™ Acessos</button>
                    <button onclick="loadLogs('admin')" class="btn btn-warning">‚öôÔ∏è Admin</button>
                    <button onclick="clearLogs()" class="btn btn-danger">üóëÔ∏è Limpar Logs</button>
                </div>

                <div class="log-viewer" id="logViewer">
                    <div class="log-entry log-info">[INFO] Sistema inicializado com sucesso</div>
                    <div class="log-entry log-info">[INFO] Carregando logs do sistema...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Vari√°veis globais
        let activityChart = null;
        let detailedChart = null;
        let documentTypeChart = null;

        // Fun√ß√£o para mostrar/esconder tabs
        function showTab(tabName) {
            // Remover classe active de todos os bot√µes e conte√∫dos
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            // Adicionar classe active ao bot√£o e conte√∫do selecionado
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');

            // Carregar dados espec√≠ficos da tab
            switch(tabName) {
                case 'users':
                    loadUsers();
                    break;
                case 'admins':
                    loadAdmins();
                    break;
                case 'documents':
                    loadDocuments();
                    break;
                case 'rag':
                    loadRAGStats();
                    break;
                case 'system':
                    loadSystemConfig();
                    break;
                case 'logs':
                    loadLogs('all');
                    break;
                case 'dashboard':
                    loadDetailedStats();
                    break;
            }
        }

        // Fun√ß√£o para logout
        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                fetch('/api/logout', { method: 'POST' })
                    .then(() => {
                        window.location.href = '/';
                    });
            }
        }

        // Fun√ß√£o para mostrar alert
        function showAlert(message, type = 'success', container = 'admin-alerts') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            const container_el = document.getElementById(container);
            container_el.innerHTML = '';
            container_el.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // Fun√ß√£o para formatar data
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleString('pt-BR');
        }

        // Fun√ß√£o para formatar moeda
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        // Fun√ß√£o principal para atualizar dados
        function refreshData() {
            loadStats();
            loadAdmins();
            document.getElementById('systemStatus').textContent = 'Sistema Online';
            document.getElementById('systemStatus').className = 'status-badge status-active';
        }

        // Carregar estat√≠sticas gerais
        function loadStats() {
            fetch('/api/admin/stats')
                .then(response => response.json())
                .then(data => {
                    // Estat√≠sticas gerais
                    const stats = data.stats;
                    document.getElementById('general-stats').innerHTML = `
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                            <div>
                                <div class="stat-number">${stats.total_users || 0}</div>
                                <div class="stat-label">Usu√°rios Totais</div>
                            </div>
                            <div>
                                <div class="stat-number">${stats.active_users_30d || 0}</div>
                                <div class="stat-label">Ativos (30 dias)</div>
                            </div>
                            <div>
                                <div class="stat-number">${stats.total_conversations || 0}</div>
                                <div class="stat-label">Conversas Totais</div>
                            </div>
                            <div>
                                <div class="stat-number">${stats.conversations_today || 0}</div>
                                <div class="stat-label">Hoje</div>
                            </div>
                        </div>
                    `;

                    // Custos
                    const costs = data.costs;
                    const budgetColor = costs.budget_used > 80 ? '#ef4444' : costs.budget_used > 60 ? '#f59e0b' : '#10b981';
                    document.getElementById('cost-stats').innerHTML = `
                        <div>
                            <div class="stat-number">${formatCurrency(costs.total)}</div>
                            <div class="stat-label">Custo Total do M√™s</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${costs.budget_used}%; background: ${budgetColor}"></div>
                            </div>
                            <div style="font-size: 0.9rem; color: ${budgetColor}; margin-top: 5px;">
                                ${costs.budget_used.toFixed(1)}% do or√ßamento usado
                            </div>
                        </div>
                        <div style="margin-top: 20px;">
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; font-size: 0.9rem;">
                                <div>Fixo: ${formatCurrency(costs.fixed)}</div>
                                <div>Vari√°vel: ${formatCurrency(costs.variable)}</div>
                            </div>
                        </div>
                    `;

                    // Top usu√°rios
                    const topUsersHtml = stats.top_users.map(user => `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #e5e7eb;">
                            <span style="color: #374151;">${user.email}</span>
                            <span style="background: #e0e7ff; color: #3730a3; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem; font-weight: 600;">
                                ${user.count} msgs
                            </span>
                        </div>
                    `).join('');

                    document.getElementById('top-users').innerHTML = topUsersHtml || '<p style="text-align: center; color: #6b7280;">Nenhum usu√°rio encontrado</p>';

                    // Gr√°fico de atividade
                    createActivityChart(stats.activity_by_day || []);
                })
                .catch(error => {
                    console.error('Erro ao carregar estat√≠sticas:', error);
                    document.getElementById('general-stats').innerHTML = '<p style="color: #ef4444;">Erro ao carregar estat√≠sticas</p>';
                    document.getElementById('cost-stats').innerHTML = '<p style="color: #ef4444;">Erro ao carregar custos</p>';
                });
        }

        // Criar gr√°fico de atividade
        function createActivityChart(activityData) {
            const ctx = document.getElementById('activityChart').getContext('2d');
            
            if (activityChart) {
                activityChart.destroy();
            }

            activityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: activityData.map(item => {
                        const date = new Date(item.date);
                        return date.toLocaleDateString('pt-BR', { weekday: 'short', day: 'numeric' });
                    }),
                    datasets: [{
                        label: 'Conversas por Dia',
                        data: activityData.map(item => item.count),
                        borderColor: '#4f46e5',
                        backgroundColor: 'rgba(79, 70, 229, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        // Carregar usu√°rios
        function loadUsers() {
            // Implementa√ß√£o simplificada
            document.getElementById('users-table').innerHTML = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Email</th>
                            <th>Status</th>
                            <th>√öltima Atividade</th>
                            <th>Mensagens</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>usuario@ipt.br</td>
                            <td><span class="status-badge status-active">Ativo</span></td>
                            <td>Hoje</td>
                            <td>15</td>
                            <td>
                                <button class="btn btn-warning" style="padding: 4px 8px; font-size: 0.8rem;">‚ö†Ô∏è Suspender</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            `;
        }

        // Carregar administradores
        function loadAdmins() {
            fetch('/api/admin/admins')
                .then(response => response.json())
                .then(admins => {
                    const tableHtml = `
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Email</th>
                                    <th>Adicionado por</th>
                                    <th>Data</th>
                                    <th>Status</th>
                                    <th>Permiss√µes</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${admins.map(admin => `
                                    <tr>
                                        <td><strong>${admin.email}</strong></td>
                                        <td>${admin.granted_by}</td>
                                        <td>${formatDate(admin.granted_at)}</td>
                                        <td>
                                            <span class="status-badge ${admin.is_active ? 'status-active' : 'status-inactive'}">
                                                ${admin.is_active ? 'Ativo' : 'Inativo'}
                                            </span>
                                        </td>
                                        <td>${admin.permissions}</td>
                                        <td>
                                            ${admin.email !== 'robsonss@ipt.br' ? 
                                                `<button onclick="removeAdmin('${admin.email}')" class="btn btn-danger" style="padding: 6px 12px; font-size: 0.8rem;">üóëÔ∏è Remover</button>` : 
                                                '<span style="color: #6b7280;">Admin Principal</span>'
                                            }
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                    document.getElementById('admins-table').innerHTML = tableHtml;
                })
                .catch(error => {
                    document.getElementById('admins-table').innerHTML = '<p style="color: #ef4444;">Erro ao carregar administradores</p>';
                });
        }

        // Adicionar administrador
        function addAdmin() {
            const email = document.getElementById('new-admin-email').value.trim();
            
            if (!email) {
                showAlert('Por favor, insira um email', 'error');
                return;
            }

            if (!email.endsWith('@ipt.br')) {
                showAlert('Email deve ser do dom√≠nio @ipt.br', 'error');
                return;
            }

            fetch('/api/admin/admins', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ email: email })
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    showAlert(data.message, 'success');
                    document.getElementById('new-admin-email').value = '';
                    loadAdmins();
                } else {
                    showAlert(data.error || 'Erro ao adicionar administrador', 'error');
                }
            })
            .catch(error => {
                showAlert('Erro ao adicionar administrador', 'error');
            });
        }

        // Remover administrador
        function removeAdmin(email) {
            if (!confirm(`Tem certeza que deseja remover o administrador ${email}?`)) {
                return;
            }

            fetch(`/api/admin/admins/${encodeURIComponent(email)}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    showAlert(data.message, 'success');
                    loadAdmins();
                } else {
                    showAlert(data.error || 'Erro ao remover administrador', 'error');
                }
            })
            .catch(error => {
                showAlert('Erro ao remover administrador', 'error');
            });
        }

        // Fun√ß√µes do RAG
        function loadRAGStats() {
            // Simula√ß√£o de dados RAG
            document.getElementById('documentsProcessed').textContent = '12';
            document.getElementById('ragQueries').textContent = '45';
        }

        function rebuildIndex() {
            if (confirm('Tem certeza que deseja reconstruir o √≠ndice RAG? Isso pode levar alguns minutos.')) {
                showAlert('Reconstru√ß√£o do √≠ndice iniciada...', 'info');
                // Implementar chamada √† API
            }
        }

        function clearDocuments() {
            if (confirm('Tem certeza que deseja limpar todos os documentos? Esta a√ß√£o n√£o pode ser desfeita.')) {
                showAlert('Documentos removidos com sucesso', 'warning');
                // Implementar chamada √† API
            }
        }

        // Fun√ß√µes do sistema
        function loadSystemConfig() {
            // Carregar configura√ß√µes atuais
            console.log('Carregando configura√ß√µes do sistema...');
        }

        function backupDatabase() {
            showAlert('Backup iniciado...', 'info');
            // Implementar backup
        }

        function optimizeDatabase() {
            showAlert('Otimiza√ß√£o da base de dados iniciada...', 'info');
            // Implementar otimiza√ß√£o
        }

        function clearOldLogs() {
            if (confirm('Remover logs com mais de 30 dias?')) {
                showAlert('Logs antigos removidos com sucesso', 'success');
            }
        }

        function exportData() {
            showAlert('Preparando exporta√ß√£o de dados...', 'info');
            // Implementar exporta√ß√£o
        }

        function exportCostReport() {
            showAlert('Gerando relat√≥rio de custos...', 'info');
            // Implementar relat√≥rio
        }

        // Fun√ß√µes de logs
        function loadLogs(type) {
            const logViewer = document.getElementById('logViewer');
            logViewer.innerHTML = `
                <div class="log-entry log-info">[${new Date().toLocaleString()}] [INFO] Carregando logs do tipo: ${type}</div>
                <div class="log-entry log-info">[${new Date().toLocaleString()}] [INFO] Sistema funcionando normalmente</div>
                <div class="log-entry log-warning">[${new Date().toLocaleString()}] [WARNING] Uso de or√ßamento em 65%</div>
            `;
        }

        function clearLogs() {
            if (confirm('Tem certeza que deseja limpar todos os logs?')) {
                document.getElementById('logViewer').innerHTML = '<div class="log-entry log-info">[INFO] Logs limpos com sucesso</div>';
            }
        }

        function loadDocuments() {
            document.getElementById('documents-table').innerHTML = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Nome do Arquivo</th>
                            <th>Usu√°rio</th>
                            <th>Tipo</th>
                            <th>Tamanho</th>
                            <th>Data Upload</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>relatorio_projeto.pdf</td>
                            <td>usuario@ipt.br</td>
                            <td>PDF</td>
                            <td>2.3 MB</td>
                            <td>Hoje</td>
                            <td><span class="status-badge status-active">Processado</span></td>
                        </tr>
                    </tbody>
                </table>
            `;
        }

        function loadDetailedStats() {
            document.getElementById('usage-metrics').innerHTML = `
                <div class="metric-value">89%</div>
                <div>Taxa de satisfa√ß√£o</div>
                <br>
                <div class="metric-value">1.2s</div>
                <div>Tempo m√©dio de resposta</div>
            `;
            
            document.getElementById('performance-metrics').innerHTML = `
                <div class="metric-value">99.8%</div>
                <div>Uptime do sistema</div>
                <br>
                <div class="metric-value">0.003</div>
                <div>Custo m√©dio por consulta</div>
            `;
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            loadStats();
            loadAdmins();
        });

        // Atualizar dados a cada 30 segundos
        setInterval(loadStats, 30000);
    </script>
</body>
</html>
